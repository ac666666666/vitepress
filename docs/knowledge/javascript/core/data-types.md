# JavaScript æ•°æ®ç±»å‹

[MDN JavaScript æ–‡æ¡£](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript)

## 1. åŸºç¡€ç±»å‹ä¸å¼•ç”¨ç±»å‹

- **åŸºç¡€ç±»å‹ (Primitive)**: `string`, `number`, `boolean`, `null`, `undefined`, `symbol`, `bigint`ã€‚
  - å­˜å‚¨åœ¨æ ˆ (Stack) ä¸­ï¼Œå æ®ç©ºé—´å°ï¼Œå¤§å°å›ºå®šï¼Œå±äºè¢«é¢‘ç¹ä½¿ç”¨çš„æ•°æ®ã€‚
- **å¼•ç”¨ç±»å‹ (Reference)**: `Object`, `Array`, `Function`, `Date`, `RegExp` ç­‰ã€‚
  - å­˜å‚¨åœ¨å † (Heap) ä¸­ï¼Œå æ®ç©ºé—´å¤§ï¼Œå¤§å°ä¸å›ºå®šã€‚å¼•ç”¨åœ°å€å­˜å‚¨åœ¨æ ˆä¸­ã€‚

### ä¸ºä»€ä¹ˆåŸºç¡€ç±»å‹å­˜æ ˆï¼Œå¼•ç”¨ç±»å‹å­˜å †ï¼Ÿ

1. **æ ˆ (Stack) çš„ç‰¹ç‚¹**ï¼š
   - **ç©ºé—´å°ä¸”è¿ç»­**ï¼šæ“ä½œç³»ç»Ÿè‡ªåŠ¨åˆ†é…å†…å­˜ç©ºé—´ã€‚
   - **å­˜å–é€Ÿåº¦å¿«**ï¼šéµå¾ª LIFOï¼ˆåè¿›å…ˆå‡ºï¼‰åŸåˆ™ï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨é‡Šæ”¾ã€‚
   - **æ•°æ®å¤§å°å›ºå®š**ï¼šåŸºç¡€ç±»å‹ï¼ˆå¦‚ `number`, `boolean`ï¼‰å ç”¨ç©ºé—´å›ºå®šï¼Œé€‚åˆå­˜å‚¨åœ¨æ ˆä¸­ã€‚

2. **å † (Heap) çš„ç‰¹ç‚¹**ï¼š
   - **ç©ºé—´å¤§ä¸”æ‚ä¹±**ï¼šå†…å­˜åˆ†é…çµæ´»ï¼Œç”±å¼€å‘è€…åˆ†é…é‡Šæ”¾ï¼ˆJS ä¸­ç”±åƒåœ¾å›æ”¶æœºåˆ¶ GC å¤„ç†ï¼‰ã€‚
   - **æ•°æ®å¤§å°ä¸å›ºå®š**ï¼šå¯¹è±¡å¯ä»¥åŠ¨æ€æ·»åŠ å±æ€§ï¼Œå¤§å°ä¸ç¡®å®šï¼Œå¦‚æœä¸æ”¾åœ¨å †ä¸­ï¼Œå®¹æ˜“å¯¼è‡´æ ˆæº¢å‡ºã€‚
   - **æ€§èƒ½è€ƒé‡**ï¼šå¦‚æœåœ¨æ ˆä¸­å­˜å‚¨å¤æ‚å¯¹è±¡ï¼Œä¼šå½±å“ç¨‹åºçš„è¿è¡Œæ€§èƒ½ï¼ˆæ ˆçš„æŸ¥æ‰¾é€Ÿåº¦ï¼‰ã€‚å› æ­¤ï¼Œå°†å¯¹è±¡çš„ **åœ°å€ï¼ˆå¼•ç”¨ï¼‰** å­˜åœ¨æ ˆä¸­ï¼Œ**å®ä½“**å­˜åœ¨å †ä¸­ã€‚

### ä¸¾ä¸ªæ —å­ ğŸŒ°

- **æ ˆ (Stack) å°±åƒæ˜¯ä½ çš„å£è¢‹**ï¼š
  - å£è¢‹ç©ºé—´å°ï¼Œæ‹¿ä¸œè¥¿éå¸¸å¿«ã€‚
  - é€‚åˆæ”¾ä¸€äº›å°çš„ã€å›ºå®šçš„ä¸œè¥¿ï¼Œæ¯”å¦‚ç¡¬å¸ï¼ˆæ•°å­—ï¼‰ã€å†™ç€â€œæ˜¯/å¦â€çš„å°çº¸æ¡ï¼ˆå¸ƒå°”å€¼ï¼‰ã€‚
  - è¿™äº›ä¸œè¥¿ä¸€æ—¦æ”¾è¿›å»ï¼Œå¤§å°å°±ä¸ä¼šå˜äº†ã€‚

- **å † (Heap) å°±åƒæ˜¯ä¸€ä¸ªå·¨å¤§çš„ä»“åº“**ï¼š
  - ä»“åº“ç©ºé—´éå¸¸å¤§ï¼Œä½†æ‰¾ä¸œè¥¿éœ€è¦æ—¶é—´ã€‚
  - é€‚åˆæ”¾é‚£äº›å¯èƒ½éšæ—¶å˜å¤§ã€ç»“æ„å¤æ‚çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ä¸€æ•´ç®±ä¹¦ï¼ˆå¯¹è±¡ï¼‰ã€ä¸€ä¸ªéšæ—¶å¯èƒ½å¢åŠ é¡µæ•°çš„ç¬”è®°æœ¬ï¼ˆæ•°ç»„ï¼‰ã€‚
  - å› ä¸ºå£è¢‹è£…ä¸ä¸‹ä»“åº“é‡Œçš„ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠ **ä»“åº“çš„é’¥åŒ™ï¼ˆå¼•ç”¨åœ°å€ï¼‰** æ”¾åœ¨å£è¢‹é‡Œã€‚
  - å½“ä½ éœ€è¦ç”¨è¿™äº›ä¸œè¥¿æ—¶ï¼Œä½ ä»å£è¢‹æå‡ºé’¥åŒ™ï¼Œå»ä»“åº“é‡Œæ‰¾åˆ°å¯¹åº”çš„ä¸œè¥¿ã€‚

```javascript
let age = 18; // åŸºç¡€ç±»å‹ï¼šç›´æ¥æŠŠ 18 æ”¾åœ¨å£è¢‹ï¼ˆæ ˆï¼‰é‡Œ
let user = { name: "AC", age: 18 };
// å¼•ç”¨ç±»å‹ï¼š
// 1. åœ¨ä»“åº“ï¼ˆå †ï¼‰é‡Œå¼€è¾Ÿä¸€å—ç©ºé—´ï¼Œå­˜æ”¾ { name: "AC", age: 18 }
// 2. æŠŠè¿™å—ç©ºé—´çš„åœ°å€ï¼ˆæ¯”å¦‚ 0x001ï¼‰å†™åœ¨çº¸æ¡ä¸Šï¼Œæ”¾åœ¨å£è¢‹ï¼ˆæ ˆï¼‰é‡Œ
```

è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆï¼š

- ä¿®æ”¹ `age` æ—¶ï¼Œæ˜¯ç›´æ¥æ¢äº†å£è¢‹é‡Œçš„ä¸œè¥¿ã€‚
- ä¿®æ”¹ `user.name` æ—¶ï¼Œæ˜¯æ‹¿ç€å£è¢‹é‡Œçš„åœ°å€ï¼Œå»ä»“åº“é‡Œä¿®æ”¹äº†å†…å®¹ã€‚
- æŠŠ `user` èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡ (`let user2 = user`)ï¼Œå…¶å®åªæ˜¯å¤å°äº†ä¸€å¼ åœ°å€çº¸æ¡ç»™ `user2`ï¼Œä»–ä»¬æŒ‡å‘çš„è¿˜æ˜¯åŒä¸€ä¸ªä»“åº“ç©ºé—´ï¼ˆæµ…æ‹·è´ï¼‰ã€‚

## 2. åˆ¤æ–­æ•°æ®ç±»å‹

### 2.1 typeof

- **ç‰¹ç‚¹**ï¼šç®€å•æ–¹ä¾¿ï¼Œé€‚åˆåˆ¤æ–­åŸºç¡€ç±»å‹ã€‚
- **å¼Šç«¯**ï¼š
  - `typeof null` === `'object'` (å†å²é—ç•™ bug)ã€‚
  - æ— æ³•åŒºåˆ†å¯¹è±¡ç±»å‹ï¼ˆ`[]`, `{}`, `Date` éƒ½ä¼šè¿”å› `'object'`ï¼‰ã€‚
  - å‡½æ•°ä¼šè¿”å› `'function'`ã€‚

```javascript
typeof "str"; // 'string'
typeof 123; // 'number'
typeof null; // 'object' âŒ
typeof []; // 'object' âŒ
typeof {}; // 'object'
typeof (() => {}); // 'function'
```

### 2.2 instanceof

- **ç‰¹ç‚¹**ï¼šæ£€æµ‹æ„é€ å‡½æ•°çš„ `prototype` å±æ€§æ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚
- **å¼Šç«¯è¯¦è§£**ï¼š

#### 1. è·¨ iframe ç¯å¢ƒå¤±æ•ˆ

å¦‚æœé¡µé¢æœ‰å¤šä¸ª iframeï¼Œæ¯ä¸ª iframe éƒ½æœ‰è‡ªå·±çš„å…¨å±€å¯¹è±¡ï¼ˆwindowï¼‰å’Œå†…ç½®æ„é€ å‡½æ•°ï¼ˆå¦‚ Arrayï¼‰ã€‚

- çˆ¶é¡µé¢çš„ `Array` å’Œ iframe ä¸­çš„ `Array` æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼ˆå†…å­˜åœ°å€ä¸åŒï¼‰ã€‚
- å½“ä½ æŠŠ iframe ä¸­çš„æ•°ç»„ä¼ ç»™çˆ¶é¡µé¢æ—¶ï¼Œçˆ¶é¡µé¢çš„ `Array` æ„é€ å‡½æ•°å¹¶ä¸åœ¨é‚£ä¸ªæ•°ç»„çš„åŸå‹é“¾ä¸Šã€‚

```javascript
const iframe = document.createElement("iframe");
document.body.appendChild(iframe);
const xArray = window.frames[0].Array; // iframe ä¸­çš„ Array æ„é€ å‡½æ•°
const arr = new xArray(1, 2, 3); // åœ¨ iframe ç¯å¢ƒåˆ›å»ºæ•°ç»„

console.log(arr instanceof Array); // false âŒ
console.log(arr instanceof xArray); // true âœ…
// æ¨èä½¿ç”¨ Array.isArray(arr) æ¥è§£å†³æ­¤é—®é¢˜
```

#### 2. åŸå‹é“¾è¢«ç¯¡æ”¹

`instanceof` çš„åˆ¤æ–­é€»è¾‘æ˜¯çœ‹ `RightHandSide.prototype` æ˜¯å¦åœ¨ `LeftHandSide` çš„åŸå‹é“¾ä¸Šã€‚å¦‚æœæˆ‘ä»¬æ‰‹åŠ¨ä¿®æ”¹äº†åŸå‹é“¾ï¼Œç»“æœå°±ä¼šä¸å‡†ç¡®ã€‚

```javascript
// ç¤ºä¾‹ 1ï¼šè®©æ™®é€šå¯¹è±¡ "ä¼ªè£…" æˆæ•°ç»„
const obj = {};
obj.__proto__ = Array.prototype; // ä¿®æ”¹åŸå‹é“¾æŒ‡å‘
console.log(obj instanceof Array); // true âŒ (å®é™…ä¸Šå®ƒåªæ˜¯ä¸ªå¯¹è±¡)

// ç¤ºä¾‹ 2ï¼šåˆ‡æ–­åŸå‹é“¾
const arr = [];
arr.__proto__ = null;
console.log(arr instanceof Array); // false âŒ (è™½ç„¶å®ƒæœ¬è´¨æ˜¯æ•°ç»„)
```

```javascript
[] instanceof Array; // true
[] instanceof Object; // true (å› ä¸º Array åŸå‹é“¾æœ€ç»ˆæŒ‡å‘ Object)
```

### 2.3 Object.prototype.toString.call() (æ¨è)

- **ç‰¹ç‚¹**ï¼šæœ€å‡†ç¡®çš„æ–¹å¼ï¼Œè¿”å› `[object Type]`ã€‚
- **åŸç†**ï¼šå€Ÿç”¨ Object åŸå‹ä¸Šçš„ toString æ–¹æ³•ï¼Œæ‰“å°å…¶å†…éƒ¨å±æ€§ `[[Class]]`ã€‚

```javascript
const getType = (val) => Object.prototype.toString.call(val).slice(8, -1);

getType(1); // "Number"
getType(null); // "Null"
getType([]); // "Array"
getType(new Date()); // "Date"
```

## 3. "==" å’Œ "===" çš„åŒºåˆ«

### 3.1 === (ä¸¥æ ¼ç›¸ç­‰)

- **è§„åˆ™**ï¼š
  - ä¸è¿›è¡Œç±»å‹è½¬æ¢ã€‚
  - ç±»å‹ç›¸åŒä¸”å€¼ç›¸åŒæ‰ä¸º `true`ã€‚
  - `NaN === NaN` ä¸º `false` (ä½¿ç”¨ `Number.isNaN()` åˆ¤æ–­)ã€‚
  - å¯¹è±¡æ¯”è¾ƒçš„æ˜¯**å¼•ç”¨åœ°å€**ã€‚

### 3.2 == (å®½æ¾ç›¸ç­‰)

- **è§„åˆ™**ï¼šå¦‚æœç±»å‹ä¸åŒï¼Œä¼šå…ˆè¿›è¡Œ**éšå¼ç±»å‹è½¬æ¢**ï¼Œå†æ¯”è¾ƒã€‚
- **è½¬æ¢é¡ºåº**ï¼š
  1. `null` == `undefined` (true)ã€‚
  2. å¦‚æœä¸€ä¸ªæ˜¯ `string`ï¼Œä¸€ä¸ªæ˜¯ `number`ï¼Œå°è¯•å°† `string` è½¬ä¸º `number`ã€‚
  3. å¦‚æœä¸€ä¸ªæ˜¯ `boolean`ï¼Œå°è¯•å°†å…¶è½¬ä¸º `number` (`true` -> 1, `false` -> 0)ã€‚
  4. å¦‚æœä¸€ä¸ªæ˜¯ `object`ï¼Œä¸€ä¸ªæ˜¯åŸºç¡€ç±»å‹ï¼Œå°è¯•å°† `object` è½¬ä¸ºåŸå§‹å€¼ (è°ƒç”¨ `valueOf` æˆ– `toString`)ã€‚

#### ç»å…¸é¢è¯•é¢˜

```javascript
[] == ![]; // true
// è§£æï¼š
// 1. ![] è½¬æ¢ä¸º boolean -> false
// 2. [] == false
// 3. false è½¬æ¢ä¸º number -> 0
// 4. [] è½¬æ¢ä¸ºåŸå§‹å€¼ -> "" (toString) -> 0 (Number)
// 5. 0 == 0 -> true
```

## 4. æ˜¾å¼ä¸éšå¼è½¬æ¢

### 4.1 æ˜¾å¼è½¬æ¢

- `Number()`: æ•´ä½“è½¬æ¢ (`Number('123a')` -> `NaN`)ã€‚
- `parseInt()`: è§£æè½¬æ¢ (`parseInt('123a')` -> `123`)ã€‚
- `String()`: è½¬å­—ç¬¦ä¸²ã€‚
- `Boolean()`: è½¬å¸ƒå°”å€¼ (`0`, `''`, `null`, `undefined`, `NaN` ä¸º falseï¼Œå…¶ä½™ä¸º true)ã€‚

### 4.2 éšå¼è½¬æ¢

- **å››åˆ™è¿ç®—**ï¼š
  - `+` å·ä¸”æœ‰ä¸€è¾¹æ˜¯å­—ç¬¦ä¸²ï¼šè¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ã€‚
  - `-`, `*`, `/`, `%`ï¼šå…¨éƒ¨è½¬ä¸ºæ•°å­—è®¡ç®—ã€‚
  ```javascript
  1 + "1"; // '11'
  1 - "1"; // 0
  ```
- **é€»è¾‘åˆ¤æ–­**ï¼š`if(value)` ä¼šè‡ªåŠ¨è°ƒç”¨ `Boolean(value)`ã€‚

### 4.3 å¯¹è±¡è½¬åŸå§‹å€¼æµç¨‹

å½“å¯¹è±¡éœ€è¦è½¬ä¸ºåŸå§‹å€¼æ—¶ï¼ˆå¦‚ `obj + 1`ï¼‰ï¼ŒJS ä¼šæŒ‰ä»¥ä¸‹é¡ºåºè°ƒç”¨ï¼š

1. `Symbol.toPrimitive` (å¦‚æœæœ‰)ã€‚
2. `valueOf()`ã€‚
3. `toString()`ã€‚

```javascript
const obj = {
  valueOf() {
    return 100;
  },
  toString() {
    return "200";
  },
};
console.log(obj + 1); // 101 (ä½¿ç”¨äº† valueOf)
```

## 5. JSON.stringify çš„å¼Šç«¯ (æ·±æ‹·è´é™·é˜±)

`JSON.parse(JSON.stringify(obj))` å¸¸ç”¨äºæ·±æ‹·è´ï¼Œä½†æœ‰ä»¥ä¸‹ä¸¢å¤±æ•°æ®çš„é£é™©ï¼š

### 1. æ— æ³•å¤„ç†çš„æƒ…å†µ

| ç±»å‹               | ç»“æœ     | ç¤ºä¾‹                                             |
| :----------------- | :------- | :----------------------------------------------- |
| **Function**       | ä¸¢å¤±     | `{ fn: () => {} }` -> `{}`                       |
| **undefined**      | ä¸¢å¤±     | `{ val: undefined }` -> `{}`                     |
| **Symbol**         | ä¸¢å¤±     | `{ [Symbol()]: 1 }` -> `{}`                      |
| **Date**           | å˜å­—ç¬¦ä¸² | `{ date: new Date() }` -> `{ date: "2023-..." }` |
| **RegExp**         | å˜ç©ºå¯¹è±¡ | `{ reg: /abc/ }` -> `{ reg: {} }`                |
| **NaN / Infinity** | å˜ null  | `{ num: NaN }` -> `{ num: null }`                |
| **å¾ªç¯å¼•ç”¨**       | **æŠ¥é”™** | `obj.a = obj` -> Uncaught TypeError              |

### 2. ä»£ç ç¤ºä¾‹

```javascript
const obj = {
  a: undefined,
  b: function () {},
  c: /abc/,
  d: new Date(),
};

const clone = JSON.parse(JSON.stringify(obj));
console.log(clone);
// {
//   c: {},
//   d: "2023-10-27T08:00:00.000Z"
// }
// a, b ä¸¢å¤±
```

### 3. æ›¿ä»£æ–¹æ¡ˆ

- **structuredClone()**: ç°ä»£æµè§ˆå™¨åŸç”Ÿæ”¯æŒçš„æ·±æ‹·è´ APIï¼Œæ”¯æŒ Date, RegExp, Map, Set ç­‰ã€‚
- **Lodash**: `_.cloneDeep(obj)`ã€‚
- **æ‰‹å†™é€’å½’**: é¢è¯•å¸¸è§æ‰‹å†™é¢˜ã€‚
